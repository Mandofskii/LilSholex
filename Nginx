FROM ubuntu:groovy
ARG NGINX_VERSION=nginx-1.20.1
# Compiling
RUN apt update && DEBIAN_FRONTEND="noninteractive" apt install -y build-essential \
openssl libpcre3 libpcre3-dev zlib1g zlib1g-dev libssl-dev python3.9 python3-pip wget \
&& apt autoremove -y && apt autoclean
RUN python3.9 -m pip install --no-cache-dir requests
WORKDIR /root
RUN wget http://nginx.org/download/$NGINX_VERSION.tar.gz && tar -xf $NGINX_VERSION.tar.gz && \
cd $NGINX_VERSION && ./configure --http-log-path=/var/log/nginx/access.log --error-log-path=/var/log/nginx/error.log \
--pid-path=/var/run/nginx.pid --conf-path=/etc/nginx/nginx.conf --without-http_autoindex_module \
--without-http_auth_basic_module --without-http_fastcgi_module --without-http_uwsgi_module --with-pcre \
--with-http_v2_module --with-http_ssl_module --with-http_realip_module --with-http_gzip_static_module \
--sbin-path=/usr/bin/nginx && make && make install && \
cd .. && rm -r $NGINX_VERSION*
# Adding Files
COPY healthchecks/nginx.py nginx.py
COPY conf/nginx.conf /etc/nginx/nginx.conf
# Volumes
VOLUME /var/log/nginx
# Opening Ports
EXPOSE 80/tcp
EXPOSE 443/tcp
# Launch
STOPSIGNAL SIGTERM
CMD nginx -g "daemon off;"